\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{\PYZbs{}NeedsTeXFormat}\PY{n+nb}{\PYZob{}}LaTeX2e\PY{n+nb}{\PYZcb{}}[1994/12/01]
\PY{k}{\PYZbs{}ProvidesPackage}\PY{n+nb}{\PYZob{}}endnotes\PY{n+nb}{\PYZcb{}}[2013/11/29 v0.12  fancy endnotes  print]
\end{Verbatim}

\NeedsTeXFormat{LaTeX2e}[1994/12/01]
\ProvidesPackage{endnotes}[2013/11/29 v0.12  fancy endnotes  print]

\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{\PYZbs{}RequirePackage}\PY{n+nb}{\PYZob{}}etoolbox\PY{n+nb}{\PYZcb{}}
\PY{k}{\PYZbs{}DeclareRobustCommand}\PY{k}{*}\PY{n+nb}{\PYZob{}}\PY{k}{\PYZbs{}flabel}\PY{n+nb}{\PYZcb{}}[2]\PY{c}{\PYZpc{}}
\PY{n+nb}{\PYZob{}}\PY{k}{\PYZbs{}phantomsection} \PY{k}{\PYZbs{}def}\PY{k}{\PYZbs{}@}currentlabel\PY{n+nb}{\PYZob{}}\PYZsh{}2\PY{n+nb}{\PYZcb{}}
\PY{k}{\PYZbs{}label}\PY{n+nb}{\PYZob{}}\PYZsh{}1\PY{n+nb}{\PYZcb{}}\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}

\PY{k}{\PYZbs{}gdef}\PY{k}{\PYZbs{}theenmark}\PY{n+nb}{\PYZob{}}\PY{k}{\PYZbs{}arabic}\PY{n+nb}{\PYZob{}}@EndnoteCounter\PY{n+nb}{\PYZcb{}}\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}gdef}\PY{k}{\PYZbs{}endnotemark}\PY{n+nb}{\PYZob{}}\PY{k}{\PYZbs{}textsuperscript}\PY{n+nb}{\PYZob{}}(\PY{k}{\PYZbs{}theenmark})\PY{n+nb}{\PYZcb{}}\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}gdef}\PY{k}{\PYZbs{}endnotemarkback}\PY{n+nb}{\PYZob{}}(\PY{k}{\PYZbs{}theenmark})\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\end{Verbatim}

\RequirePackage{etoolbox}
\DeclareRobustCommand*{\flabel}[2]%
{\phantomsection \def\@currentlabel{#2}
\label{#1}}%

\gdef\theenmark{\arabic{@EndnoteCounter}}%
\gdef\endnotemark{\textsuperscript{(\theenmark)}}%
\gdef\endnotemarkback{(\theenmark)}%

\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{\PYZbs{}newwrite}\PY{k}{\PYZbs{}@}entout

\PY{k}{\PYZbs{}newcounter}\PY{n+nb}{\PYZob{}}@EndnoteCounter\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}newcounter}\PY{n+nb}{\PYZob{}}@AllEndnoteCounter\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}newcounter}\PY{n+nb}{\PYZob{}}@ShowEndnoteCounter\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}setcounter}\PY{n+nb}{\PYZob{}}@EndnoteCounter\PY{n+nb}{\PYZcb{}}\PY{n+nb}{\PYZob{}}0\PY{n+nb}{\PYZcb{}}
\PY{k}{\PYZbs{}setcounter}\PY{n+nb}{\PYZob{}}@AllEndnoteCounter\PY{n+nb}{\PYZcb{}}\PY{n+nb}{\PYZob{}}0\PY{n+nb}{\PYZcb{}}
\PY{k}{\PYZbs{}setcounter}\PY{n+nb}{\PYZob{}}@ShowEndnoteCounter\PY{n+nb}{\PYZcb{}}\PY{n+nb}{\PYZob{}}1\PY{n+nb}{\PYZcb{}}

\PY{k}{\PYZbs{}newif}\PY{k}{\PYZbs{}if}@entopen \PY{k}{\PYZbs{}global}\PY{k}{\PYZbs{}@}entopenfalse
\end{Verbatim}

\newwrite\@entout

\newcounter{@EndnoteCounter}%
\newcounter{@AllEndnoteCounter}%
\newcounter{@ShowEndnoteCounter}%
\setcounter{@EndnoteCounter}{0}
\setcounter{@AllEndnoteCounter}{0}
\setcounter{@ShowEndnoteCounter}{1}

\newif\if@entopen \global\@entopenfalse

\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{\PYZbs{}def}\PY{k}{\PYZbs{}@}openent\PY{n+nb}{\PYZob{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}def}\PY{k}{\PYZbs{}@}entname\PY{n+nb}{\PYZob{}}\PY{k}{\PYZbs{}jobname}
\PY{k}{\PYZbs{}ifnum}\PY{k}{\PYZbs{}value}\PY{n+nb}{\PYZob{}}@ShowEndnoteCounter\PY{n+nb}{\PYZcb{}}\PYZlt{}10 0\PY{k}{\PYZbs{}fi}
\PY{k}{\PYZbs{}ifnum}\PY{k}{\PYZbs{}value}\PY{n+nb}{\PYZob{}}@ShowEndnoteCounter\PY{n+nb}{\PYZcb{}}\PYZlt{}100 0\PY{k}{\PYZbs{}fi}
\PY{k}{\PYZbs{}arabic}\PY{n+nb}{\PYZob{}}@ShowEndnoteCounter\PY{n+nb}{\PYZcb{}}\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}

\PY{k}{\PYZbs{}immediate}\PY{k}{\PYZbs{}openout}\PY{k}{\PYZbs{}@}entout=\PY{k}{\PYZbs{}@}entname.ent\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}global}\PY{k}{\PYZbs{}@}entopentrue
\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\end{Verbatim}

\def\@openent{%
\def\@entname{\jobname
\ifnum\value{@ShowEndnoteCounter}<10 0\fi
\ifnum\value{@ShowEndnoteCounter}<100 0\fi
\arabic{@ShowEndnoteCounter}}%

\immediate\openout\@entout=\@entname.ent%
\global\@entopentrue
}%

\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{\PYZbs{}begingroup} \PY{k}{\PYZbs{}catcode} `|=0 \PY{k}{\PYZbs{}catcode} `[=1
\PY{k}{\PYZbs{}catcode}`]=2 \PY{k}{\PYZbs{}catcode} `\PY{k}{\PYZbs{}\PYZob{}}=12 \PY{k}{\PYZbs{}catcode} `\PY{k}{\PYZbs{}\PYZcb{}}=12
\PY{k}{\PYZbs{}catcode}`\PY{k}{\PYZbs{}\PYZbs{}}=12
|gdef|@writeent[|immediate|write|@entout[
\PY{n+nb}{\PYZob{}}\PY{k}{\PYZbs{}footnotesize}
\PY{k}{\PYZbs{}hspace}\PY{n+nb}{\PYZob{}}\PYZhy{}2\PY{k}{\PYZbs{}parindent}\PY{n+nb}{\PYZcb{}}\PY{k}{\PYZbs{}makebox}\PY{n+na}{[\PYZbs{}parindent\PYZhy{}3pt]}\PY{n+na}{[l]}
\PY{n+nb}{\PYZob{}}\PY{k}{\PYZbs{}flabel}\PY{n+nb}{\PYZob{}}|@linknameb\PY{n+nb}{\PYZcb{}}\PY{n+nb}{\PYZob{}}|@showlinknameb\PY{n+nb}{\PYZcb{}}  \PY{k}{\PYZbs{}ref}\PY{n+nb}{\PYZob{}}|@linkname\PY{n+nb}{\PYZcb{}}\PY{n+nb}{\PYZcb{}}
\PY{k}{\PYZbs{}leftskip}=\PY{k}{\PYZbs{}parindent}   |expandonce|@include \PY{k}{\PYZbs{}par} \PY{n+nb}{\PYZcb{}} ] ]\PY{c}{\PYZpc{}}
|endgroup
\end{Verbatim}

\begingroup \catcode `|=0 \catcode `[=1
\catcode`]=2 \catcode `\{=12 \catcode `\}=12
\catcode`\\=12
|gdef|@writeent[|immediate|write|@entout[
{\footnotesize
\hspace{-2\parindent}\makebox[\parindent-3pt][l]
{\flabel{|@linknameb}{|@showlinknameb}  \ref{|@linkname}}
\leftskip=\parindent   |expandonce|@include \par } ] ]%
|endgroup

\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{\PYZbs{}DeclareRobustCommand}\PY{k}{*}\PY{k}{\PYZbs{}endnote}\PY{n+na}{[1]}\PY{n+nb}{\PYZob{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}stepcounter}\PY{n+nb}{\PYZob{}}@EndnoteCounter\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}stepcounter}\PY{n+nb}{\PYZob{}}@AllEndnoteCounter\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}edef}\PY{k}{\PYZbs{}@}linkname\PY{n+nb}{\PYZob{}}enote:\PY{k}{\PYZbs{}arabic}\PY{n+nb}{\PYZob{}}@AllEndnoteCounter\PY{n+nb}{\PYZcb{}}\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}edef}\PY{k}{\PYZbs{}@}linknameb\PY{n+nb}{\PYZob{}}enote:\PY{k}{\PYZbs{}arabic}\PY{n+nb}{\PYZob{}}@AllEndnoteCounter\PY{n+nb}{\PYZcb{}}b\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}edef}\PY{k}{\PYZbs{}@}showlinknameb\PY{n+nb}{\PYZob{}}\PY{k}{\PYZbs{}endnotemark}\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}edef}\PY{k}{\PYZbs{}@}showlinkname\PY{n+nb}{\PYZob{}}\PY{k}{\PYZbs{}endnotemarkback}\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}ignorespaces}\PY{k}{\PYZbs{}flabel}\PY{n+nb}{\PYZob{}}\PY{k}{\PYZbs{}@}linkname\PY{n+nb}{\PYZcb{}}\PY{n+nb}{\PYZob{}}\PY{k}{\PYZbs{}@}showlinkname\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}ignorespaces}\PY{k}{\PYZbs{}hspace}\PY{n+nb}{\PYZob{}}\PYZhy{}0.5ex\PY{n+nb}{\PYZcb{}}\PY{k}{\PYZbs{}ref}\PY{n+nb}{\PYZob{}}\PY{k}{\PYZbs{}@}linkname b\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}if}@entopen \PY{k}{\PYZbs{}else} \PY{k}{\PYZbs{}@}openent \PY{k}{\PYZbs{}fi}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}begingroup}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}let}\PY{k}{\PYZbs{}protect}\PY{k}{\PYZbs{}string}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}gdef}\PY{k}{\PYZbs{}@}include\PY{n+nb}{\PYZob{}}\PYZsh{}1\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}endgroup}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}@}writeent\PY{c}{\PYZpc{}}
\PY{n+nb}{\PYZcb{}}
\end{Verbatim}

\DeclareRobustCommand*\endnote[1]{%
\stepcounter{@EndnoteCounter}%
\stepcounter{@AllEndnoteCounter}%
\edef\@linkname{enote:\arabic{@AllEndnoteCounter}}%
\edef\@linknameb{enote:\arabic{@AllEndnoteCounter}b}%
\edef\@showlinknameb{\endnotemark}%
\edef\@showlinkname{\endnotemarkback}%
\ignorespaces\flabel{\@linkname}{\@showlinkname}%
\ignorespaces\hspace{-0.5ex}\ref{\@linkname b}%
\if@entopen \else \@openent \fi%
\begingroup%
\let\protect\string%
\gdef\@include{#1}%
\endgroup%
\@writeent%
}

\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{\PYZbs{}DeclareRobustCommand}\PY{k}{*}\PY{k}{\PYZbs{}showendnotes}\PY{n+nb}{\PYZob{}}\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}immediate}\PY{k}{\PYZbs{}closeout}\PY{k}{\PYZbs{}@}entout\PY{c}{\PYZpc{}}
\PY{k}{\PYZbs{}global}\PY{k}{\PYZbs{}@}entopenfalse

\PY{k}{\PYZbs{}input}\PY{n+nb}{\PYZob{}}\PY{k}{\PYZbs{}@}entname.ent\PY{n+nb}{\PYZcb{}}

\PY{k}{\PYZbs{}setcounter}\PY{n+nb}{\PYZob{}}@EndnoteCounter\PY{n+nb}{\PYZcb{}}\PY{n+nb}{\PYZob{}}0\PY{n+nb}{\PYZcb{}}
\PY{k}{\PYZbs{}stepcounter}\PY{n+nb}{\PYZob{}}@ShowEndnoteCounter\PY{n+nb}{\PYZcb{}}\PY{c}{\PYZpc{}}

\PY{n+nb}{\PYZcb{}}

\PY{k}{\PYZbs{}endinput}
\end{Verbatim}

\DeclareRobustCommand*\showendnotes{%
\immediate\closeout\@entout%
\global\@entopenfalse

\input{\@entname.ent}

\setcounter{@EndnoteCounter}{0}
\stepcounter{@ShowEndnoteCounter}%

}

\endinput

